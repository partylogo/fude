# Admin Date Rule è¨­è¨ˆè‰æ¡ˆ

> **ç›®çš„**ï¼šè®“å¾Œå°åœ¨å»ºç«‹ / ç·¨è¼¯äº‹ä»¶ (Event) æ™‚ï¼Œåªè¦è¼¸å…¥ã€Œ*è¦å‰‡*ã€ä¸€æ¬¡ï¼Œå¾Œç«¯å³å¯è‡ªå‹•ç”¢ç”Ÿæœªä¾†å¤šå¹´çš„åœ‹æ›†å°æ‡‰æ—¥æœŸã€‚
> 
> â€‘ æ¸›å°‘æ¯å¹´é‡è¤‡å»ºè³‡æ–™çš„è² æ“”  
> â€‘ åŒæ™‚æ”¯æ´ã€Œåœ‹æ›†å›ºå®šã€ã€ã€Œè¾²æ›†å›ºå®š (å«é–æœˆ)ã€ã€ã€Œä¸€æ¬¡æ€§æ´»å‹•ã€ä¸‰ç¨®é¡å‹

---

## ğŸ¯ è¨­è¨ˆé‚è¼¯èªªæ˜ï¼ˆéæŠ€è¡“äººå“¡ç‰ˆï¼‰

### ç¾åœ¨çš„å•é¡Œ
ç›®å‰æ¯å€‹ç¥æ˜ç”Ÿæ—¥éƒ½è¦æ‰‹å‹•è¼¸å…¥ã€Œé€™ä¸€å¹´çš„åœ‹æ›†æ—¥æœŸã€ï¼Œä¾‹å¦‚ï¼š
- åª½ç¥–è–èª•ï¼šè¾²æ›† 3/23ï¼Œä½†æ¯å¹´åœ‹æ›†æ—¥æœŸä¸åŒ
- 2025å¹´å¯èƒ½æ˜¯ 4/20ï¼Œ2026å¹´å¯èƒ½æ˜¯ 4/9
- **æ¯å¹´éƒ½è¦é‡æ–°æŸ¥è¾²æ°‘æ›†ï¼Œç„¶å¾Œæ‰‹å‹•è¼¸å…¥æ–°æ—¥æœŸ** â† å¾ˆéº»ç…©ï¼

### æˆ‘å€‘çš„è§£æ±ºæ–¹æ¡ˆ
**æ”¹æˆã€Œè¼¸å…¥è¦å‰‡ã€ï¼Œè®“ç³»çµ±è‡ªå‹•è¨ˆç®—**

#### æ­¥é©Ÿ1ï¼šç®¡ç†å“¡åªè¦è¨­å®šä¸€æ¬¡è¦å‰‡
åœ¨å¾Œå°å»ºç«‹äº‹ä»¶æ™‚ï¼Œé¸æ“‡ï¼š
- ã€Œé€™æ˜¯è¾²æ›†äº‹ä»¶ã€âœ…
- ã€Œè¾²æ›† 3æœˆ 23æ—¥ã€
- ã€Œåª½ç¥–è–èª•ã€
- **å®Œæˆï¼** ä¸ç”¨ç®¡åœ‹æ›†æ˜¯å¹¾è™Ÿ

#### æ­¥é©Ÿ2ï¼šç³»çµ±æ¯å¤©è‡ªå‹•å·¥ä½œ
ç³»çµ±æœƒåœ¨èƒŒæ™¯ï¼š
- è‡ªå‹•æŸ¥è©¢ã€Œè¾²æ›†3/23åœ¨2025å¹´æ˜¯åœ‹æ›†å¹¾è™Ÿï¼Ÿã€
- è‡ªå‹•æŸ¥è©¢ã€Œè¾²æ›†3/23åœ¨2026å¹´æ˜¯åœ‹æ›†å¹¾è™Ÿï¼Ÿã€
- è‡ªå‹•ç”¢ç”Ÿæœªä¾†3å¹´çš„æ‰€æœ‰æ—¥æœŸ
- å„²å­˜åˆ°è³‡æ–™åº«

#### æ­¥é©Ÿ3ï¼šApp ç›´æ¥æ‹¿ç¾æˆç­”æ¡ˆ
iOS App å•ï¼šã€Œ2025å¹´æœ‰å“ªäº›ç¥æ˜ç”Ÿæ—¥ï¼Ÿã€
ç³»çµ±ç›´æ¥å›ç­”ï¼šã€Œåª½ç¥–è–èª• 4/20ã€é—œå…¬è–èª• 7/15...ã€
**ä¸ç”¨å³æ™‚è¨ˆç®—ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼**

### ç‰¹æ®Šæƒ…æ³è™•ç†

#### ğŸŒ™ é–æœˆæ€éº¼è¾¦ï¼Ÿ
æœ‰äº›å¹´ä»½æœƒæœ‰ã€Œé–3æœˆã€ï¼Œé€™æ™‚å€™æœƒæœ‰å…©å€‹ã€Œ3æœˆ23æ—¥ã€ï¼š
- **å¹³æœˆ**ï¼šä¸€èˆ¬çš„3æœˆ23æ—¥
- **é–æœˆ**ï¼šå¤šå‡ºä¾†çš„é–3æœˆ23æ—¥

æˆ‘å€‘æä¾›3ç¨®é¸æ“‡ï¼š
1. **åªéå¹³æœˆ**ï¼ˆæœ€å¸¸è¦‹ï¼‰ï¼šå°±åƒå¹³å¸¸ä¸€æ¨£
2. **å¹³æœˆ+é–æœˆéƒ½é**ï¼šé–æœˆå¹´æœƒæ…¶ç¥å…©æ¬¡
3. **åªéé–æœˆ**ï¼ˆç½•è¦‹ï¼‰ï¼šåªæœ‰é–æœˆå¹´æ‰æ…¶ç¥

#### ğŸ“… åœ‹æ›†å›ºå®šç¯€æ—¥
åƒæ–°å¹´ã€è–èª•ç¯€é€™ç¨®åœ‹æ›†å›ºå®šçš„ï¼š
- ç›´æ¥è¨­å®šã€Œåœ‹æ›† 12æœˆ 25æ—¥ã€
- ç³»çµ±æ¯å¹´è‡ªå‹•ç”¢ç”Ÿ 12/25

#### ğŸª ä¸€æ¬¡æ€§æ´»å‹•
å»Ÿæœƒã€ç‰¹æ®Šæ³•æœƒï¼š
- ç›´æ¥é¸æ—¥æœŸã€Œ2025å¹´ 6æœˆ 15æ—¥ã€
- ç³»çµ±åªæœƒåœ¨é‚£ä¸€å¤©é¡¯ç¤º

#### ğŸŒ ç¯€æ°£äº‹ä»¶ï¼ˆæ–°å¢ï¼‰
æ¸…æ˜æƒå¢“ã€å†¬è‡³è£œå†¬ã€ç«‹æ˜¥ç¥ˆç¦ï¼š
- é¸æ“‡ã€Œç¯€æ°£äº‹ä»¶ã€â†’ é¸æ“‡ã€Œæ¸…æ˜ã€
- ç³»çµ±è‡ªå‹•æŸ¥è©¢ä¸­å¤®æ°£è±¡å±€æ¬Šå¨è³‡æ–™
- æ¯å¹´ç¯€æ°£æ—¥æœŸéƒ½ä¸åŒï¼Œä½†ç³»çµ±é å…ˆçŸ¥é“æœªä¾†5å¹´çš„ç²¾ç¢ºæ—¥æœŸ

### ç”¨æˆ¶é«”é©—æ”¹å–„

#### ğŸ‘¨â€ğŸ’¼ ç®¡ç†å“¡é«”é©—
**ä»¥å‰**ï¼šæ¯å¹´åˆè¦é‡æ–°æŸ¥è¾²æ°‘æ›†ï¼Œæ›´æ–°50+å€‹ç¥æ˜ç”Ÿæ—¥
**ç¾åœ¨**ï¼šè¨­å®šä¸€æ¬¡è¦å‰‡ï¼Œ3å¹´å…§éƒ½ä¸ç”¨ç®¡

**è¡¨å–®æœƒå¾ˆè°æ˜**ï¼š
- é¸ã€Œç¥æ˜ç”Ÿæ—¥ã€â†’ è‡ªå‹•è·³å‡ºè¾²æ›†é¸é …
- é¸ã€Œæ°‘ä¿—ç¯€æ…¶ã€â†’ è®“ä½ é¸è¾²æ›†æˆ–åœ‹æ›†
- é¸ã€Œè‡ªå®šç¾©æ´»å‹•ã€â†’ ç›´æ¥é¸æ—¥æœŸ

#### ğŸ“± ä½¿ç”¨è€…é«”é©—
**å®Œå…¨ç„¡æ„Ÿ**ï¼šApp ç…§å¸¸é¡¯ç¤ºäº‹ä»¶ï¼Œä½†è³‡æ–™æ›´å³æ™‚ã€æ›´æº–ç¢º

### ç³»çµ±å®‰å…¨æ©Ÿåˆ¶

#### ğŸ”§ å¦‚æœè‡ªå‹•ç³»çµ±å£æ‰ï¼Ÿ
**ä¸æœƒå½±éŸ¿Appé‹ä½œ**ï¼š
- å¹³å¸¸ç”¨ã€Œé å…ˆè¨ˆç®—å¥½çš„æ—¥æœŸã€ï¼ˆå¾ˆå¿«ï¼‰
- ç·Šæ€¥æ™‚ç”¨ã€Œå³æ™‚è¨ˆç®—ã€ï¼ˆç¨æ…¢ä½†æœ‰æ•ˆï¼‰

#### âœ… å¦‚æœè¦ä¿®æ”¹è¦å‰‡ï¼Ÿ
**ç‰ˆæœ¬æ§åˆ¶**ï¼š
- ä¿®æ”¹è¾²æ›†è¦å‰‡æ™‚ï¼Œç³»çµ±çŸ¥é“è¦é‡æ–°è¨ˆç®—
- èˆŠçš„éŒ¯èª¤æ—¥æœŸæœƒè‡ªå‹•æ¸…é™¤
- æ–°çš„æ­£ç¢ºæ—¥æœŸæœƒè‡ªå‹•ç”¢ç”Ÿ

#### ğŸ“Š ç®¡ç†å“¡ç›£æ§
**ä¸€ç›®äº†ç„¶çš„ç‹€æ…‹**ï¼š
- çœ‹åˆ°æœ‰å¤šå°‘äº‹ä»¶ç­‰å¾…ç”Ÿæˆæ—¥æœŸ
- çœ‹åˆ°ç³»çµ±æœ€å¾Œä»€éº¼æ™‚å€™å·¥ä½œ
- å¯ä»¥æ‰‹å‹•è§¸ç™¼ã€Œç«‹å³è¨ˆç®—ã€

### ğŸ“ˆ æ•ˆç›Šç¸½çµ

| é …ç›® | æ”¹å–„æ•ˆæœ |
|------|----------|
| **ç®¡ç†è² æ“”** | æ¯å¹´50+å°æ™‚ â†’ å¹¾ä¹0å°æ™‚ |
| **è³‡æ–™æº–ç¢ºæ€§** | äººå·¥æŸ¥è©¢æ˜“éŒ¯ â†’ ç³»çµ±è‡ªå‹•æº–ç¢º |
| **Appæ•ˆèƒ½** | æ¯æ¬¡éƒ½è¦ç®— â†’ æ‹¿ç¾æˆè³‡æ–™ |
| **æœªä¾†æ“´å……** | ç¡¬å¯«ç¨‹å¼ â†’ å½ˆæ€§è¦å‰‡è¨­å®š |

**ç°¡å–®èªªï¼šä¸€æ¬¡è¨­å®šï¼Œçµ‚èº«å—ç”¨ï¼** ğŸš€

---

## 1. è³‡æ–™æ¬„ä½è¨­è¨ˆ

### 1.1 events table (ä¸»è¦å‰‡è¡¨)

| æ¬„ä½             | å‹åˆ¥            | å‚™è¨» |
| ---------------- | --------------- | ---- |
| `id`             | serial PK       |      |
| `type`           | enum            | `deity` / `festival` / `solar_term` / `custom` |
| `title`          | text            |      |
| `description`    | text            |      |
| `is_lunar`       | boolean         | æ˜¯å¦ä»¥è¾²æ›†ç‚ºåŸºæº– (ç¥æ˜ç”Ÿæ—¥å¤šç‚º `true`) |
| `lunar_month`    | int 1-12        | `is_lunar=true` æ™‚å¿…å¡« |
| `lunar_day`      | int 1-30        | â€‘ |
| `leap_behavior`  | enum            | `never_leap` / `always_leap` / `both` (é è¨­ `never_leap`) |
| `solar_month`    | int 1-12        | `is_lunar=false` æ™‚å¿…å¡« |
| `solar_day`      | int 1-31        | â€‘ |
| `one_time_date`  | date            | ä¸€æ¬¡æ€§æ´»å‹•å°ˆç”¨ï¼›å¡«å®šåœ‹æ›† yyyy-MM-dd |
| `solar_term_name` | varchar(10) FK | ç¯€æ°£åç¨± (`type=solar_term` æ™‚å¿…å¡«) â†’ solar_term_types.name |
| `rule_version`   | int             | è¦å‰‡ç‰ˆæœ¬è™Ÿï¼Œä¿®æ”¹è¾²æ›†/åœ‹æ›†è¦å‰‡æ™‚+1ï¼Œç”¨æ–¼é‡æ–°ç”Ÿæˆ |
| `generated_until` | int            | å·²ç”¢ç”Ÿ occurrences åˆ°å“ªä¸€å¹´ (è¥¿å…ƒå¹´ä»½) |
| å…¶é¤˜æ¬„ä½         | ...             | å°é¢ã€è·æŒã€notes ç­‰ |

**ç´„æŸæ¢ä»¶**:
```sql
CONSTRAINT uk_event_rule_version UNIQUE (id, rule_version);
CONSTRAINT fk_solar_term_name FOREIGN KEY (solar_term_name) REFERENCES solar_term_types(name);
```

**ç³»çµ±è¨­å®š**:
- **çµ±ä¸€å»¶ä¼¸ç­–ç•¥**: ç’°å¢ƒè®Šæ•¸ `EXTEND_YEARS=5` (å¯èª¿æ•´ï¼Œé è¨­5å¹´)
- **è‡ªå‹•ç¶­è­·ç¯„åœ**: `currentYear` åˆ° `currentYear + EXTEND_YEARS`
- **æ™‚å€è¨­å®š**: çµ±ä¸€ä½¿ç”¨å°ç£æ™‚å€ (Asia/Taipei) é¿å… UTC è½‰æ›å•é¡Œ

> **é—œä¿‚**ï¼š`is_lunar` + `lunar_*` èˆ‡ `solar_*` / `one_time_date` äº’æ–¥
> **é–æœˆé‚è¼¯**ï¼š
> - `never_leap`ï¼šæ°¸é ä½¿ç”¨å¹³æœˆï¼ˆå¸¸è¦‹ï¼Œå¦‚åœŸåœ°å…¬ç”Ÿæ—¥è¾²æ›†2/2ï¼‰
> - `always_leap`ï¼šåƒ…é–æœˆæ™‚æ…¶ç¥ï¼ˆç½•è¦‹ï¼‰
> - `both`ï¼šé–æœˆå¹´æœƒæœ‰å…©æ¬¡æ…¶ç¥ï¼ˆå¦‚åª½ç¥–è–èª•è¾²æ›†3/23ï¼Œé–3æœˆæ™‚3/23å’Œé–3/23éƒ½æ…¶ç¥ï¼‰

### 1.2 solar_term_types table (ç¯€æ°£åƒç…§è¡¨)

| æ¬„ä½             | å‹åˆ¥            | å‚™è¨» |
| ---------------- | --------------- | ---- |
| `name`           | varchar(10) PK  | ç¯€æ°£åç¨± (ç«‹æ˜¥ã€é›¨æ°´ã€é©šèŸ„...) |
| `display_order`  | int             | é¡¯ç¤ºé †åº (1-24) |
| `season`         | varchar(10)     | æ‰€å±¬å­£ç¯€ (æ˜¥å¤ç§‹å†¬) |
| `description`    | text            | ç¯€æ°£èªªæ˜ |

**é è¨­è³‡æ–™**:
```sql
INSERT INTO solar_term_types (name, display_order, season) VALUES
  ('ç«‹æ˜¥', 1, 'æ˜¥'), ('é›¨æ°´', 2, 'æ˜¥'), ('é©šèŸ„', 3, 'æ˜¥'), ('æ˜¥åˆ†', 4, 'æ˜¥'),
  ('æ¸…æ˜', 5, 'æ˜¥'), ('ç©€é›¨', 6, 'æ˜¥'), ('ç«‹å¤', 7, 'å¤'), ('å°æ»¿', 8, 'å¤'),
  ('èŠ’ç¨®', 9, 'å¤'), ('å¤è‡³', 10, 'å¤'), ('å°æš‘', 11, 'å¤'), ('å¤§æš‘', 12, 'å¤'),
  ('ç«‹ç§‹', 13, 'ç§‹'), ('è™•æš‘', 14, 'ç§‹'), ('ç™½éœ²', 15, 'ç§‹'), ('ç§‹åˆ†', 16, 'ç§‹'),
  ('å¯’éœ²', 17, 'ç§‹'), ('éœœé™', 18, 'ç§‹'), ('ç«‹å†¬', 19, 'å†¬'), ('å°é›ª', 20, 'å†¬'),
  ('å¤§é›ª', 21, 'å†¬'), ('å†¬è‡³', 22, 'å†¬'), ('å°å¯’', 23, 'å†¬'), ('å¤§å¯’', 24, 'å†¬');
```

### 1.3 event_occurrences table (é ç”Ÿæˆæ—¥æœŸè¡¨)

| æ¬„ä½             | å‹åˆ¥            | å‚™è¨» |
| ---------------- | --------------- | ---- |
| `event_id`       | int FK          | â†’ events.id |
| `occurrence_date` | date           | è©²å¹´å¯¦éš›åœ‹æ›†æ—¥æœŸ (yyyy-MM-dd) |
| `year`           | int             | è¥¿å…ƒå¹´ä»½ (ä¿ç•™ä¾›å¿«é€ŸæŸ¥è©¢å¹´åº¦ç¯„åœ) |
| `is_leap_month`  | boolean         | è©²æ¬¡æ˜¯å¦ä¾†è‡ªé–æœˆè¨ˆç®— |
| `generated_at`   | timestamptz     | ç”¢ç”Ÿæ™‚é–“ |
| `rule_version`   | int             | å°æ‡‰çš„ events.rule_version |

**ä¸»éµèˆ‡ç´„æŸ**: 
```sql
PRIMARY KEY (event_id, occurrence_date);  -- é˜²æ­¢åŒäº‹ä»¶åŒæ—¥æœŸé‡è¤‡
-- æ³¨æ„ï¼šå› ç‚º events è¡¨ä¸»éµç‚º (id)ï¼Œéœ€å…ˆå»ºç«‹ UNIQUE ç´„æŸæ‰èƒ½å»ºç«‹ FK
-- é€™å€‹ç´„æŸåœ¨ events è¡¨ä¸­å·²å®šç¾©ï¼šUNIQUE (id, rule_version)
CONSTRAINT fk_event_rule_version 
  FOREIGN KEY (event_id, rule_version) 
  REFERENCES events(id, rule_version);    -- ç¢ºä¿è¦å‰‡ç‰ˆæœ¬ä¸€è‡´æ€§
```

**ç´¢å¼•**: 
```sql
CREATE INDEX idx_occurrences_date_range ON event_occurrences (occurrence_date, event_id);
CREATE INDEX idx_occurrences_year ON event_occurrences (year, event_id);
-- å¯é¸ï¼šç§»é™¤ year æ¬„ä½ï¼Œæ”¹ç”¨ functional index
-- CREATE INDEX idx_occurrences_year_func ON event_occurrences (DATE_PART('year', occurrence_date), event_id);
```

### 1.4 generation_errors table (éŒ¯èª¤è¨˜éŒ„è¡¨)

| æ¬„ä½             | å‹åˆ¥            | å‚™è¨» |
| ---------------- | --------------- | ---- |
| `id`             | serial PK       |      |
| `event_id`       | int FK          | â†’ events.id |
| `error_type`     | varchar(50)     | `lunar_conversion`, `cron_failure`, `api_error`, `solar_term_lookup` |
| `error_message`  | text            | è©³ç´°éŒ¯èª¤è¨Šæ¯ |
| `context_data`   | jsonb           | éŒ¯èª¤ç™¼ç”Ÿæ™‚çš„ç›¸é—œè³‡æ–™ (å¹´ä»½ã€è¾²æ›†æ—¥æœŸç­‰) |
| `retryable`      | boolean         | æ˜¯å¦å¯è‡ªå‹•é‡è©¦ (é è¨­ true) |
| `occurred_at`    | timestamptz     | éŒ¯èª¤æ™‚é–“ |
| `resolved_at`    | timestamptz     | è§£æ±ºæ™‚é–“ (nullable) |

**ç´¢å¼•**:
```sql
CREATE INDEX idx_errors_event_time ON generation_errors (event_id, occurred_at DESC);
CREATE INDEX idx_errors_unresolved ON generation_errors (occurred_at) WHERE resolved_at IS NULL;
```

### 1.5 solar_terms table (ç¯€æ°£è³‡æ–™è¡¨)

| æ¬„ä½             | å‹åˆ¥            | å‚™è¨» |
| ---------------- | --------------- | ---- |
| `year`           | int             | è¥¿å…ƒå¹´ä»½ |
| `term_name`      | varchar(10) FK  | ç¯€æ°£åç¨± â†’ solar_term_types.name |
| `occurrence_date` | date           | è©²å¹´ç¯€æ°£ç²¾ç¢ºæ—¥æœŸ |
| `source`         | varchar(50)     | è³‡æ–™ä¾†æº (å›ºå®šç‚º 'central_weather_bureau') |
| `imported_at`    | timestamptz     | è³‡æ–™åŒ¯å…¥æ™‚é–“ |

**ä¸»éµèˆ‡ç´„æŸ**:
```sql
PRIMARY KEY (year, term_name);
CONSTRAINT fk_solar_term_name FOREIGN KEY (term_name) REFERENCES solar_term_types(name);
```

**ç´¢å¼•**:
```sql
CREATE INDEX idx_solar_terms_date ON solar_terms (occurrence_date);
CREATE INDEX idx_solar_terms_year ON solar_terms (year);
```

---

## 2. å¾Œç«¯æ’ç¨‹ / API ç”¢ç”Ÿé‚è¼¯

### 2.1 äº‹ä»¶è¦å‰‡ç•°å‹•è™•ç†
```js
// PUT /api/events/:id - ä¿®æ”¹è¦å‰‡æ™‚
async function updateEventRule(eventId, newRuleData) {
  const oldEvent = await getEvent(eventId);
  
  // æª¢æŸ¥è¦å‰‡æ˜¯å¦æœ‰è®Šå‹•
  const ruleChanged = hasRuleChanged(oldEvent, newRuleData);
  
  if (ruleChanged) {
    // 1. æ›´æ–°è¦å‰‡ç‰ˆæœ¬è™Ÿ
    newRuleData.rule_version = (oldEvent.rule_version || 0) + 1;
    
    // 2. åˆªé™¤èˆŠçš„ occurrencesï¼ˆæœªä¾†æ—¥æœŸï¼‰
    await deleteOccurrences(eventId, { afterDate: new Date() });
    
    // 3. æ¨™è¨˜éœ€è¦é‡æ–°ç”Ÿæˆ
    newRuleData.generated_until = null;
  }
  
  await updateEvent(eventId, newRuleData);
  
  // 4. ç«‹å³ç”Ÿæˆæ–° occurrences
  if (ruleChanged) {
    await generateOccurrences(eventId);
  }
}
```

### 2.2 Cron Job (æ™ºèƒ½ç”Ÿæˆç­–ç•¥)
```js
// æ¯æ—¥ 02:00 åŸ·è¡Œ
async function dailyOccurrenceGeneration() {
  const currentYear = new Date().getFullYear();
  
  // æŸ¥è©¢éœ€è¦ç”Ÿæˆçš„äº‹ä»¶ï¼šgenerated_until < currentYear + auto_extend_years
  const events = await query(`
    SELECT id, auto_extend_years, generated_until, rule_version 
    FROM events 
    WHERE generated_until IS NULL 
       OR generated_until < $1
  `, [currentYear + 3]); // é è¨­æœ€å°‘ä¿è­‰ 3 å¹´
  
  const results = { success: 0, failed: 0, errors: [] };
  
  for (const event of events) {
    try {
      await generateOccurrences(event.id);
      results.success++;
    } catch (error) {
      results.failed++;
      results.errors.push({ event_id: event.id, error: error.message });
      
      // è¨˜éŒ„åˆ°å°ˆé–€çš„éŒ¯èª¤è¡¨ï¼Œä¸å†ä½¿ç”¨ console.error
      await insertGenerationError({
        event_id: event.id,
        error_type: 'cron_failure',
        error_message: error.message,
        retryable: !error.message.includes('invalid') && !error.message.includes('malformed'), // æ™ºèƒ½åˆ¤æ–·æ˜¯å¦å¯é‡è©¦
        context_data: { 
          rule_version: event.rule_version,
          generated_until: event.generated_until,
          current_year: currentYear 
        }
      });
    }
  }
  
  console.log(`Cron completed: ${results.success} success, ${results.failed} failed`);
  return results;
}

async function generateOccurrences(eventId) {
  const event = await getEvent(eventId);
  // ç’°å¢ƒè®Šæ•¸é…ç½®ï¼šå¯èª¿æ•´å»¶ä¼¸å¹´é™
  const EXTEND_YEARS = parseInt(process.env.EXTEND_YEARS) || 5;
  
  // çµ±ä¸€æ™‚å€è™•ç†ï¼šä½¿ç”¨å°ç£æ™‚å€
  const taiwanTime = new Date().toLocaleString("en-US", {timeZone: "Asia/Taipei"});
  const currentYear = new Date(taiwanTime).getFullYear();
  const targetYear = currentYear + EXTEND_YEARS;
  
  // æ±ºå®šç”Ÿæˆç¯„åœï¼šå¾ generated_until+1 æˆ– currentYear é–‹å§‹
  const startYear = event.generated_until ? Math.max(event.generated_until + 1, currentYear) : currentYear;
  
  const newOccurrences = [];
  
  for (let year = startYear; year <= targetYear; year++) {
    if (event.one_time_date) {
      // ä¸€æ¬¡æ€§æ´»å‹•ï¼šåªæœ‰æŒ‡å®šå¹´ä»½
      if (year === new Date(event.one_time_date).getFullYear()) {
        newOccurrences.push({
          event_id: eventId,
          occurrence_date: event.one_time_date,
          year,
          is_leap_month: false,
          rule_version: event.rule_version
        });
      }
    } else if (event.type === 'solar_term') {
      // ç¯€æ°£äº‹ä»¶ï¼šå¾ solar_terms è¡¨æŸ¥è©¢
      try {
        const solarTermDate = await getSolarTermDate(event.solar_term_name, year);
        if (solarTermDate) {
          newOccurrences.push({
            event_id: eventId,
            occurrence_date: solarTermDate,
            year,
            is_leap_month: false,
            rule_version: event.rule_version
          });
        }
      } catch (error) {
        await insertGenerationError({
          event_id: eventId,
          error_type: 'solar_term_lookup',
          error_message: error.message,
          context_data: { year, solar_term_name: event.solar_term_name }
        });
        throw error;
      }
    } else if (event.is_lunar) {
      // è¾²æ›†äº‹ä»¶ï¼šè™•ç†é–æœˆé‚è¼¯
      try {
        const dates = await calculateLunarDates(event, year);
        newOccurrences.push(...dates);
      } catch (error) {
        await insertGenerationError({
          event_id: eventId,
          error_type: 'lunar_conversion',
          error_message: error.message,
          context_data: { year, lunar_month: event.lunar_month, lunar_day: event.lunar_day }
        });
        throw error; // é‡æ–°æ‹‹å‡ºï¼Œè®“ä¸Šå±¤è™•ç†
      }
    } else {
      // åœ‹æ›†äº‹ä»¶
      const solarDate = new Date(year, event.solar_month - 1, event.solar_day);
      newOccurrences.push({
        event_id: eventId,
        occurrence_date: solarDate.toISOString().split('T')[0],
        year,
        is_leap_month: false,
        rule_version: event.rule_version
      });
    }
  }
  
  // æ‰¹é‡æ’å…¥ï¼Œä½¿ç”¨ ON CONFLICT é¿å…é‡è¤‡ï¼ˆé–æœˆå»é‡ï¼‰
  if (newOccurrences.length > 0) {
    await insertOccurrencesWithConflictHandling(newOccurrences);
  }
  
  // æ›´æ–° generated_until
  await updateEvent(eventId, { generated_until: targetYear });
}

async function calculateLunarDates(event, year) {
  const occurrences = [];
  
  // å¹³æœˆæ—¥æœŸ
  if (event.leap_behavior !== 'always_leap') {
    try {
      const solarDate = await convertLunarToSolar(year, event.lunar_month, event.lunar_day, false);
      occurrences.push({
        event_id: event.id,
        occurrence_date: solarDate,
        year,
        is_leap_month: false,
        rule_version: event.rule_version
      });
    } catch (error) {
      // å¹³æœˆè½‰æ›å¤±æ•—æ˜¯åš´é‡éŒ¯èª¤ï¼Œéœ€è¦è¨˜éŒ„
      await insertGenerationError({
        event_id: event.id,
        error_type: 'lunar_conversion',
        error_message: `å¹³æœˆè½‰æ›å¤±æ•—: ${error.message}`,
        context_data: { year, lunar_month: event.lunar_month, lunar_day: event.lunar_day, is_leap: false }
      });
      throw error;
    }
  }
  
  // é–æœˆæ—¥æœŸ
  if (event.leap_behavior === 'always_leap' || event.leap_behavior === 'both') {
    try {
      const leapSolarDate = await convertLunarToSolar(year, event.lunar_month, event.lunar_day, true);
      occurrences.push({
        event_id: event.id,
        occurrence_date: leapSolarDate,
        year,
        is_leap_month: true,
        rule_version: event.rule_version
      });
    } catch (error) {
      // é–æœˆè½‰æ›å¤±æ•—é€šå¸¸æ˜¯è©²å¹´ç„¡é–æœˆï¼Œä¸ç®—éŒ¯èª¤
      console.debug(`é–æœˆè½‰æ›ç•¥é ${year}/${event.lunar_month}/${event.lunar_day}: ${error.message}`);
    }
  }
  
  return occurrences;
}

// è¼”åŠ©å‡½æ•¸ï¼šå¸¶è¡çªè™•ç†çš„æ‰¹é‡æ’å…¥
async function insertOccurrencesWithConflictHandling(occurrences) {
  const values = occurrences.map(occ => 
    `(${occ.event_id}, '${occ.occurrence_date}', ${occ.year}, ${occ.is_leap_month}, ${occ.rule_version})`
  ).join(',');
  
  await query(`
    INSERT INTO event_occurrences 
      (event_id, occurrence_date, year, is_leap_month, rule_version)
    VALUES ${values}
    ON CONFLICT (event_id, occurrence_date) DO NOTHING
  `);
}

// è¼”åŠ©å‡½æ•¸ï¼šæ’å…¥éŒ¯èª¤è¨˜éŒ„
async function insertGenerationError(errorData) {
  await query(`
    INSERT INTO generation_errors 
      (event_id, error_type, error_message, retryable, context_data)
    VALUES ($1, $2, $3, $4, $5)
  `, [
    errorData.event_id,
    errorData.error_type,
    errorData.error_message,
    errorData.retryable !== undefined ? errorData.retryable : true, // é è¨­å¯é‡è©¦
    JSON.stringify(errorData.context_data)
  ]);
}

// è¼”åŠ©å‡½æ•¸ï¼šæŸ¥è©¢ç¯€æ°£æ—¥æœŸ
async function getSolarTermDate(termName, year) {
  const result = await query(`
    SELECT occurrence_date 
    FROM solar_terms 
    WHERE term_name = $1 AND year = $2
  `, [termName, year]);
  
  if (!result.rows.length) {
    // å¦‚æœè³‡æ–™åº«ä¸­æ²’æœ‰è©²å¹´åº¦ç¯€æ°£è³‡æ–™ï¼Œè§¸ç™¼è£œå……é‚è¼¯
    await ensureSolarTermsData(year);
    
    // é‡æ–°æŸ¥è©¢
    const retryResult = await query(`
      SELECT occurrence_date 
      FROM solar_terms 
      WHERE term_name = $1 AND year = $2
    `, [termName, year]);
    
    return retryResult.rows[0]?.occurrence_date;
  }
  
  return result.rows[0].occurrence_date;
}

// ç¢ºä¿ç¯€æ°£è³‡æ–™å­˜åœ¨ï¼ˆ5å¹´ç¯„åœï¼‰
async function ensureSolarTermsData(targetYear) {
  const currentYear = new Date().getFullYear();
  const maxYear = currentYear + 5; // 5å¹´é è¼‰ç­–ç•¥
  
  if (targetYear > maxYear) {
    throw new Error(`ç¯€æ°£è³‡æ–™è¶…å‡ºæ”¯æ´ç¯„åœï¼Œæœ€å¤§å¹´ä»½ï¼š${maxYear}`);
  }
  
  // æª¢æŸ¥æ˜¯å¦å·²æœ‰è©²å¹´åº¦è³‡æ–™
  const existingData = await query(`
    SELECT COUNT(*) as count 
    FROM solar_terms 
    WHERE year = $1
  `, [targetYear]);
  
  if (existingData.rows[0].count == 0) {
    // è§¸ç™¼å¾ä¸­å¤®æ°£è±¡å±€åŒ¯å…¥è©²å¹´åº¦è³‡æ–™
    await importSolarTermsFromCWB(targetYear);
  }
}

// å¹´åº¦è‡ªå‹•ç¶­è­·æ©Ÿåˆ¶ (æ¯å¹´ 1/1 åŸ·è¡Œ)
async function annualMaintenanceJob() {
  // ç’°å¢ƒè®Šæ•¸é…ç½®ï¼šå¯èª¿æ•´å»¶ä¼¸å¹´é™
  const EXTEND_YEARS = parseInt(process.env.EXTEND_YEARS) || 5;
  
  // çµ±ä¸€æ™‚å€è™•ç†ï¼šä½¿ç”¨å°ç£æ™‚å€
  const taiwanTime = new Date().toLocaleString("en-US", {timeZone: "Asia/Taipei"});
  const currentYear = new Date(taiwanTime).getFullYear();
  const targetYear = currentYear + EXTEND_YEARS;
  
  const maintenanceRecord = {
    maintenance_type: 'annual_extension',
    target_year: targetYear,
    events_processed: 0,
    occurrences_created: 0,
    occurrences_deleted: 0,
    solar_terms_processed: 0,
    status: 'running',
    started_at: new Date()
  };
  
  try {
    // è¨˜éŒ„ç¶­è­·é–‹å§‹
    const recordResult = await query(`
      INSERT INTO system_maintenance (maintenance_type, target_year, status, started_at)
      VALUES ($1, $2, $3, $4)
      RETURNING id
    `, [maintenanceRecord.maintenance_type, maintenanceRecord.target_year, 
        maintenanceRecord.status, maintenanceRecord.started_at]);
    
    const maintenanceId = recordResult.rows[0].id;
    
    // 1. æ¸…ç†éæœŸçš„ occurrence è³‡æ–™ (æ™‚å€å®‰å…¨è™•ç†)
    const cleanupDate = new Date(currentYear, 0, 1).toISOString().split('T')[0]; // ç•¶åœ°æ™‚å€çš„1æœˆ1æ—¥
    const deleteResult = await query(`
      DELETE FROM event_occurrences 
      WHERE occurrence_date < $1
    `, [cleanupDate]);
    
    maintenanceRecord.occurrences_deleted = deleteResult.rowCount;
    
    // 2. å»¶ä¼¸æ‰€æœ‰éœ€è¦æ›´æ–°çš„äº‹ä»¶
    const eventsNeedExtension = await query(`
      SELECT id FROM events 
      WHERE generated_until IS NULL OR generated_until < $1
    `, [targetYear]);
    
    let totalCreatedOccurrences = 0;
    
    for (const event of eventsNeedExtension.rows) {
      const beforeCount = await getOccurrenceCount(event.id);
      await generateOccurrences(event.id);
      const afterCount = await getOccurrenceCount(event.id);
      totalCreatedOccurrences += (afterCount - beforeCount);
    }
    
    maintenanceRecord.events_processed = eventsNeedExtension.rows.length;
    maintenanceRecord.occurrences_created = totalCreatedOccurrences;
    
    // 3. å»¶ä¼¸ç¯€æ°£è³‡æ–™ (ç¢ºä¿æœ‰æœªä¾†5å¹´çš„ç¯€æ°£è³‡æ–™)
    const solarTermYears = [];
    for (let year = currentYear; year <= targetYear; year++) {
      await ensureSolarTermsData(year);
      solarTermYears.push(year);
    }
    
    maintenanceRecord.solar_terms_processed = solarTermYears.length;
    
    // 4. æ›´æ–°ç¶­è­·è¨˜éŒ„ç‚ºå®Œæˆ
    await query(`
      UPDATE system_maintenance 
      SET status = 'completed',
          completed_at = NOW(),
          events_processed = $1,
          occurrences_created = $2,
          occurrences_deleted = $3,
          solar_terms_processed = $4
      WHERE id = $5
    `, [maintenanceRecord.events_processed, maintenanceRecord.occurrences_created,
        maintenanceRecord.occurrences_deleted, maintenanceRecord.solar_terms_processed,
        maintenanceId]);
    
    console.log(`Annual maintenance completed:`, maintenanceRecord);
    return { success: true, ...maintenanceRecord };
    
  } catch (error) {
    // è¨˜éŒ„å¤±æ•—
    await query(`
      UPDATE system_maintenance 
      SET status = 'failed',
          completed_at = NOW(),
          error_message = $1
      WHERE maintenance_type = 'annual_extension' 
        AND status = 'running'
        AND started_at >= $2
    `, [error.message, new Date(Date.now() - 60000)]); // 1åˆ†é˜å…§çš„é‹è¡Œè¨˜éŒ„
    
    throw error;
  }
}

// è¼”åŠ©å‡½æ•¸ï¼šç²å–äº‹ä»¶çš„ occurrence æ•¸é‡
async function getOccurrenceCount(eventId) {
  const result = await query(`
    SELECT COUNT(*) as count 
    FROM event_occurrences 
    WHERE event_id = $1
  `, [eventId]);
  
  return parseInt(result.rows[0].count);
}
```

### 2.3 API æŸ¥è©¢ (å« Fallback)
```js
// GET /api/events?from=2025-01-01&to=2025-12-31
async function getEvents(fromDate, toDate) {
  // ä¸»è¦æŸ¥è©¢ï¼šé ç”Ÿæˆçš„ occurrences
  let events = await query(`
    SELECT e.*, eo.occurrence_date, eo.is_leap_month
    FROM events e
    JOIN event_occurrences eo ON e.id = eo.event_id
    WHERE eo.occurrence_date BETWEEN $1 AND $2
    ORDER BY eo.occurrence_date
  `, [fromDate, toDate]);
  
  // Fallbackï¼šå¦‚æœæŸäº›äº‹ä»¶æ²’æœ‰ occurrencesï¼Œå³æ™‚è¨ˆç®—
  const eventsWithoutOccurrences = await getEventsWithoutOccurrences(fromDate, toDate);
  
  for (const event of eventsWithoutOccurrences) {
    try {
      const dynamicOccurrences = await calculateEventOccurrences(event, fromDate, toDate);
      events.push(...dynamicOccurrences);
      
      // èƒŒæ™¯ç”Ÿæˆï¼ˆä¸é˜»å¡å›æ‡‰ï¼‰
      setImmediate(() => generateOccurrences(event.id));
      
    } catch (error) {
      console.error(`Fallback calculation failed for event ${event.id}:`, error);
    }
  }
  
  return events.sort((a, b) => new Date(a.occurrence_date) - new Date(b.occurrence_date));
}
```

**å®¹éŒ¯æ©Ÿåˆ¶**ï¼š
- Cron å¤±æ•—ä¸å½±éŸ¿ API å›æ‡‰ï¼ˆå³æ™‚è¨ˆç®— fallbackï¼‰
- èƒŒæ™¯è£œç”Ÿæˆç¼ºå¤±çš„ occurrences  
- éŒ¯èª¤æ—¥èªŒè¨˜éŒ„èˆ‡ç›£æ§

---

## 3. React Admin UI è®Šå‹•

### 3.1 ç¯€æ°£å¸¸æ•¸æª”æ¡ˆ (å…±ç”¨å‰å¾Œç«¯)

```js
// constants/solarTerms.js
export const SOLAR_TERMS = [
  { name: 'ç«‹æ˜¥', order: 1, season: 'æ˜¥' },
  { name: 'é›¨æ°´', order: 2, season: 'æ˜¥' },
  { name: 'é©šèŸ„', order: 3, season: 'æ˜¥' },
  { name: 'æ˜¥åˆ†', order: 4, season: 'æ˜¥' },
  { name: 'æ¸…æ˜', order: 5, season: 'æ˜¥' },
  { name: 'ç©€é›¨', order: 6, season: 'æ˜¥' },
  { name: 'ç«‹å¤', order: 7, season: 'å¤' },
  { name: 'å°æ»¿', order: 8, season: 'å¤' },
  { name: 'èŠ’ç¨®', order: 9, season: 'å¤' },
  { name: 'å¤è‡³', order: 10, season: 'å¤' },
  { name: 'å°æš‘', order: 11, season: 'å¤' },
  { name: 'å¤§æš‘', order: 12, season: 'å¤' },
  { name: 'ç«‹ç§‹', order: 13, season: 'ç§‹' },
  { name: 'è™•æš‘', order: 14, season: 'ç§‹' },
  { name: 'ç™½éœ²', order: 15, season: 'ç§‹' },
  { name: 'ç§‹åˆ†', order: 16, season: 'ç§‹' },
  { name: 'å¯’éœ²', order: 17, season: 'ç§‹' },
  { name: 'éœœé™', order: 18, season: 'ç§‹' },
  { name: 'ç«‹å†¬', order: 19, season: 'å†¬' },
  { name: 'å°é›ª', order: 20, season: 'å†¬' },
  { name: 'å¤§é›ª', order: 21, season: 'å†¬' },
  { name: 'å†¬è‡³', order: 22, season: 'å†¬' },
  { name: 'å°å¯’', order: 23, season: 'å†¬' },
  { name: 'å¤§å¯’', order: 24, season: 'å†¬' }
];

export const getSolarTermChoices = () => 
  SOLAR_TERMS.map(term => ({ id: term.name, name: term.name }));
```

### 3.2 æ™ºèƒ½è¡¨å–®è¨­è¨ˆ

```jsx
// EventCreate.jsx - æ”¹é€²ç‰ˆè¡¨å–®
import { getSolarTermChoices } from '../constants/solarTerms';

const EventForm = () => {
  const [eventType, setEventType] = useState('deity'); // é è¨­ç¥æ˜
  const [isLunar, setIsLunar] = useState(true); // ç¥æ˜é è¨­è¾²æ›†
  
  return (
    <SimpleForm>
      <SelectInput 
        source="type" 
        choices={[
          { id: 'deity', name: 'ç¥æ˜ç”Ÿæ—¥' },
          { id: 'festival', name: 'æ°‘ä¿—ç¯€æ…¶' },
          { id: 'solar_term', name: 'ç¯€æ°£äº‹ä»¶' },
          { id: 'custom', name: 'è‡ªå®šç¾©æ´»å‹•' }
        ]}
        onChange={(type) => {
          setEventType(type);
          // ç¥æ˜ç”Ÿæ—¥é è¨­è¾²æ›†ï¼Œå…¶ä»–è®“ä½¿ç”¨è€…é¸
          setIsLunar(type === 'deity');
        }}
      />
      
      <TextInput source="title" label="äº‹ä»¶åç¨±" required />
      <TextInput source="description" label="æè¿°" multiline />
      
      {/* æ™ºèƒ½æ—¥æœŸé¸æ“‡ */}
      <FormDataConsumer>
        {({ formData }) => (
          <>
            <BooleanInput 
              source="is_lunar" 
              label="ä½¿ç”¨è¾²æ›†æ—¥æœŸ"
              helperText={formData.type === 'deity' ? 'ç¥æ˜ç”Ÿæ—¥é€šå¸¸ä½¿ç”¨è¾²æ›†' : ''}
            />
            
            {formData.is_lunar ? (
              <>
                <NumberInput source="lunar_month" label="è¾²æ›†æœˆä»½" min={1} max={12} required />
                <NumberInput source="lunar_day" label="è¾²æ›†æ—¥æœŸ" min={1} max={30} required />
                <SelectInput 
                  source="leap_behavior" 
                  label="é–æœˆè™•ç†"
                  choices={[
                    { id: 'never_leap', name: 'åƒ…å¹³æœˆï¼ˆå¸¸è¦‹ï¼‰' },
                    { id: 'both', name: 'å¹³æœˆ+é–æœˆï¼ˆå¦‚åª½ç¥–è–èª•ï¼‰' },
                    { id: 'always_leap', name: 'åƒ…é–æœˆï¼ˆç½•è¦‹ï¼‰' }
                  ]}
                  defaultValue="never_leap"
                  helperText="é–æœˆå¹´æ˜¯å¦é¡å¤–æ…¶ç¥"
                />
              </>
            ) : formData.type === 'solar_term' ? (
              <SelectInput 
                source="solar_term_name" 
                label="é¸æ“‡ç¯€æ°£"
                choices={getSolarTermChoices()}
                required
                helperText="ç³»çµ±å°‡è‡ªå‹•æŸ¥è©¢ä¸­å¤®æ°£è±¡å±€æ¬Šå¨ç¯€æ°£æ—¥æœŸ"
              />
            ) : formData.type === 'custom' ? (
              <DateInput source="one_time_date" label="æŒ‡å®šæ—¥æœŸ" />
            ) : (
              <>
                <NumberInput source="solar_month" label="åœ‹æ›†æœˆä»½" min={1} max={12} required />
                <NumberInput source="solar_day" label="åœ‹æ›†æ—¥æœŸ" min={1} max={31} required />
              </>
            )}
          </>
        )}
      </FormDataConsumer>
      
      {/* è‡ªå‹•ç”¢ç”Ÿå¹´æ•¸å·²çµ±ä¸€ç‚º5å¹´ï¼Œç„¡éœ€ç”¨æˆ¶è¨­å®š */}
    </SimpleForm>
  );
};
```

### 3.2 åˆ—è¡¨é¡¯ç¤ºå¢å¼·

```jsx
// EventList.jsx - å¢å¼·ç‰ˆåˆ—è¡¨
const EventList = () => (
  <List>
    <Datagrid>
      <TextField source="title" label="äº‹ä»¶åç¨±" />
      <ChipField source="type" label="é¡å‹" />
      
      {/* é¡¯ç¤ºè¦å‰‡æ‘˜è¦ */}
      <FunctionField 
        label="æ—¥æœŸè¦å‰‡"
        render={record => {
          if (record.one_time_date) {
            return `ä¸€æ¬¡æ€§ ${record.one_time_date}`;
          } else if (record.type === 'solar_term') {
            return `ç¯€æ°£ ${record.solar_term_name}`;
          } else if (record.is_lunar) {
            const leap = record.leap_behavior === 'both' ? '+é–æœˆ' : 
                        record.leap_behavior === 'always_leap' ? 'åƒ…é–æœˆ' : '';
            return `è¾²æ›† ${record.lunar_month}/${record.lunar_day} ${leap}`;
          } else {
            return `åœ‹æ›† ${record.solar_month}/${record.solar_day}`;
          }
        }}
      />
      
      {/* ä¸‹æ¬¡ç™¼ç”Ÿæ—¥æœŸ */}
      <FunctionField 
        label="æœ€è¿‘æ—¥æœŸ"
        render={record => {
          // ç”± API æä¾›æœ€è¿‘ä¸€æ¬¡çš„ occurrence_date
          return record.next_occurrence_date || 'æœªç”Ÿæˆ';
        }}
      />
      
      <DateField source="last_generated" label="æœ€å¾Œç”Ÿæˆ" showTime />
      <EditButton />
      <DeleteButton />
    </Datagrid>
  </List>
);
```

### 3.3 è³‡æ–™é©—è­‰

```jsx
// å‰ç«¯é©—è­‰é‚è¼¯
const validateEvent = (values) => {
  const errors = {};
  
  if (!values.title) errors.title = 'äº‹ä»¶åç¨±ç‚ºå¿…å¡«';
  
  if (values.is_lunar) {
    if (!values.lunar_month || values.lunar_month < 1 || values.lunar_month > 12) {
      errors.lunar_month = 'è¾²æ›†æœˆä»½ç¯„åœ 1-12';
    }
    if (!values.lunar_day || values.lunar_day < 1 || values.lunar_day > 30) {
      errors.lunar_day = 'è¾²æ›†æ—¥æœŸç¯„åœ 1-30';
    }
  } else if (values.type !== 'custom') {
    if (!values.solar_month || values.solar_month < 1 || values.solar_month > 12) {
      errors.solar_month = 'åœ‹æ›†æœˆä»½ç¯„åœ 1-12';
    }
    if (!values.solar_day || values.solar_day < 1 || values.solar_day > 31) {
      errors.solar_day = 'åœ‹æ›†æ—¥æœŸç¯„åœ 1-31';
    }
  } else if (!values.one_time_date) {
    errors.one_time_date = 'ä¸€æ¬¡æ€§æ´»å‹•éœ€è¦æŒ‡å®šæ—¥æœŸ';
  }
  
  return errors;
};
```

### 3.4 ç³»çµ±ç¶­è­·ç›£æ§é¢æ¿

```jsx
// æ–°å¢ï¼šSystemMaintenanceMonitor.jsx
const SystemMaintenanceMonitor = () => {
  const [extensionStatus, setExtensionStatus] = useState({});
  const [maintenanceHistory, setMaintenanceHistory] = useState([]);
  const [loading, setLoading] = useState(false);
  
  useEffect(() => {
    fetchSystemStatus();
    fetchMaintenanceHistory();
  }, []);
  
  const fetchSystemStatus = async () => {
    try {
      const response = await apiClient.get('/system/extension-status');
      setExtensionStatus(response.data);
    } catch (error) {
      console.error('Failed to fetch system status:', error);
    }
  };
  
  const fetchMaintenanceHistory = async () => {
    try {
      const response = await apiClient.get('/system/maintenance-history?limit=5');
      setMaintenanceHistory(response.data.records);
    } catch (error) {
      console.error('Failed to fetch maintenance history:', error);
    }
  };
  
  const triggerManualMaintenance = async () => {
    setLoading(true);
    try {
      await apiClient.post('/system/trigger-maintenance');
      // é‡æ–°è¼‰å…¥è³‡æ–™
      await fetchSystemStatus();
      await fetchMaintenanceHistory();
      alert('æ‰‹å‹•ç¶­è­·å·²è§¸ç™¼å®Œæˆï¼');
    } catch (error) {
      alert(`ç¶­è­·å¤±æ•—ï¼š${error.response?.data?.message || error.message}`);
    } finally {
      setLoading(false);
    }
  };
  
  return (
    <Card>
      <CardHeader title="ğŸ“… ç³»çµ±æ—¥æœŸå»¶ä¼¸ç‹€æ…‹" />
      <CardContent>
        <Grid container spacing={3}>
          {/* å»¶ä¼¸ç‹€æ…‹æ¦‚è¦½ */}
          <Grid item xs={12}>
            <Paper elevation={1} style={{ padding: '16px', backgroundColor: '#f5f5f5' }}>
              <Typography variant="h6" gutterBottom>ğŸ¯ ç•¶å‰å»¶ä¼¸ç¯„åœ</Typography>
              <Grid container spacing={2}>
                <Grid item xs={3}>
                  <Stat 
                    label="ç³»çµ±å»¶ä¼¸è‡³" 
                    value={`${extensionStatus.max_extended_year || 'æœªçŸ¥'} å¹´`}
                    color="primary"
                  />
                </Grid>
                <Grid item xs={3}>
                  <Stat 
                    label="ç¸½äº‹ä»¶æ•¸é‡" 
                    value={extensionStatus.total_events || 0}
                  />
                </Grid>
                <Grid item xs={3}>
                  <Stat 
                    label="éœ€è¦å»¶ä¼¸" 
                    value={extensionStatus.events_need_extension || 0}
                    color={extensionStatus.events_need_extension > 0 ? "error" : "success"}
                  />
                </Grid>
                <Grid item xs={3}>
                  <Button 
                    variant="contained" 
                    color="primary"
                    disabled={loading}
                    onClick={triggerManualMaintenance}
                    startIcon={loading ? <CircularProgress size={20} /> : <RefreshIcon />}
                  >
                    {loading ? 'åŸ·è¡Œä¸­...' : 'æ‰‹å‹•å»¶ä¼¸'}
                  </Button>
                </Grid>
              </Grid>
            </Paper>
          </Grid>
          
          {/* ç¶­è­·æ­·å²è¨˜éŒ„ */}
          <Grid item xs={12}>
            <Typography variant="h6" gutterBottom>ğŸ”§ æœ€è¿‘ç¶­è­·è¨˜éŒ„</Typography>
            <TableContainer component={Paper}>
              <Table size="small">
                <TableHead>
                  <TableRow>
                    <TableCell>ç¶­è­·æ™‚é–“</TableCell>
                    <TableCell>ç›®æ¨™å¹´ä»½</TableCell>
                    <TableCell>è™•ç†äº‹ä»¶</TableCell>
                    <TableCell>æ–°å¢æ—¥æœŸ</TableCell>
                    <TableCell>æ¸…ç†æ—¥æœŸ</TableCell>
                    <TableCell>ç‹€æ…‹</TableCell>
                  </TableRow>
                </TableHead>
                <TableBody>
                  {maintenanceHistory.map((record) => (
                    <TableRow key={record.id}>
                      <TableCell>
                        {new Date(record.started_at).toLocaleDateString('zh-TW')}
                      </TableCell>
                      <TableCell>{record.target_year}</TableCell>
                      <TableCell>{record.events_processed}</TableCell>
                      <TableCell>{record.occurrences_created}</TableCell>
                      <TableCell>{record.occurrences_deleted}</TableCell>
                      <TableCell>
                        <Chip 
                          label={record.status} 
                          color={record.status === 'completed' ? 'success' : 
                                record.status === 'failed' ? 'error' : 'default'}
                          size="small"
                        />
                      </TableCell>
                    </TableRow>
                  ))}
                </TableBody>
              </Table>
            </TableContainer>
          </Grid>
          
          {/* ç³»çµ±è³‡è¨Š */}
          <Grid item xs={12}>
            <Alert severity="info">
              <AlertTitle>ğŸ“‹ ç³»çµ±å»¶ä¼¸ç­–ç•¥</AlertTitle>
              â€¢ <strong>çµ±ä¸€å»¶ä¼¸å¹´é™</strong>ï¼šæ‰€æœ‰äº‹ä»¶è‡ªå‹•å»¶ä¼¸è‡³æœªä¾†5å¹´<br/>
              â€¢ <strong>è‡ªå‹•ç¶­è­·</strong>ï¼šæ¯å¹´1æœˆ1æ—¥è‡ªå‹•åŸ·è¡Œå»¶ä¼¸èˆ‡æ¸…ç†<br/>
              â€¢ <strong>è³‡æ–™æ¸…ç†</strong>ï¼šè‡ªå‹•ç§»é™¤ç•¶å¹´åº¦ä¹‹å‰çš„éæœŸæ—¥æœŸè¨˜éŒ„<br/>
              â€¢ <strong>ç¯€æ°£è³‡æ–™</strong>ï¼šåŒæ­¥å»¶ä¼¸ä¸­å¤®æ°£è±¡å±€ç¯€æ°£è³‡æ–™
            </Alert>
          </Grid>
        </Grid>
      </CardContent>
    </Card>
  );
};
```

### 3.5 å¾Œç«¯ç›£æ§ API

```js
// GET /api/system/extension-status - å–å¾—å»¶ä¼¸ç‹€æ…‹
app.get('/api/system/extension-status', async (req, res) => {
  try {
    const result = await query('SELECT * FROM system_extension_status');
    res.json(result.rows[0] || {});
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

// GET /api/system/maintenance-history - å–å¾—ç¶­è­·æ­·å²
app.get('/api/system/maintenance-history', async (req, res) => {
  try {
    const limit = parseInt(req.query.limit) || 10;
    const result = await query(`
      SELECT * FROM system_maintenance 
      ORDER BY started_at DESC 
      LIMIT $1
    `, [limit]);
    
    res.json({ records: result.rows });
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

// POST /api/system/trigger-maintenance - æ‰‹å‹•è§¸ç™¼ç¶­è­·
app.post('/api/system/trigger-maintenance', async (req, res) => {
  try {
    const result = await annualMaintenanceJob();
    res.json({ 
      message: 'ç¶­è­·å®Œæˆ', 
      ...result 
    });
  } catch (error) {
    res.status(500).json({ 
      error: 'ç¶­è­·å¤±æ•—', 
      message: error.message 
    });
  }
});
```

---

## 4. ç§»è½‰ç­–ç•¥

### 4.1 åˆ†éšæ®µå®‰å…¨ç§»è½‰

```sql
-- Phase 1: å»ºç«‹ç¯€æ°£åƒç…§è¡¨
CREATE TABLE solar_term_types (
  name VARCHAR(10) PRIMARY KEY,
  display_order INTEGER NOT NULL,
  season VARCHAR(10) NOT NULL,
  description TEXT
);

INSERT INTO solar_term_types (name, display_order, season) VALUES
  ('ç«‹æ˜¥', 1, 'æ˜¥'), ('é›¨æ°´', 2, 'æ˜¥'), ('é©šèŸ„', 3, 'æ˜¥'), ('æ˜¥åˆ†', 4, 'æ˜¥'),
  ('æ¸…æ˜', 5, 'æ˜¥'), ('ç©€é›¨', 6, 'æ˜¥'), ('ç«‹å¤', 7, 'å¤'), ('å°æ»¿', 8, 'å¤'),
  ('èŠ’ç¨®', 9, 'å¤'), ('å¤è‡³', 10, 'å¤'), ('å°æš‘', 11, 'å¤'), ('å¤§æš‘', 12, 'å¤'),
  ('ç«‹ç§‹', 13, 'ç§‹'), ('è™•æš‘', 14, 'ç§‹'), ('ç™½éœ²', 15, 'ç§‹'), ('ç§‹åˆ†', 16, 'ç§‹'),
  ('å¯’éœ²', 17, 'ç§‹'), ('éœœé™', 18, 'ç§‹'), ('ç«‹å†¬', 19, 'å†¬'), ('å°é›ª', 20, 'å†¬'),
  ('å¤§é›ª', 21, 'å†¬'), ('å†¬è‡³', 22, 'å†¬'), ('å°å¯’', 23, 'å†¬'), ('å¤§å¯’', 24, 'å†¬');

-- Phase 2: æ–°å¢æ¬„ä½ (ä¿ç•™èˆŠ solar_date é™£åˆ—)
ALTER TABLE events ADD COLUMN is_lunar BOOLEAN DEFAULT false;
ALTER TABLE events ADD COLUMN lunar_month INTEGER;
ALTER TABLE events ADD COLUMN lunar_day INTEGER;
ALTER TABLE events ADD COLUMN leap_behavior VARCHAR(20) DEFAULT 'never_leap';
ALTER TABLE events ADD COLUMN solar_month INTEGER;
ALTER TABLE events ADD COLUMN solar_day INTEGER;
ALTER TABLE events ADD COLUMN one_time_date DATE;
ALTER TABLE events ADD COLUMN solar_term_name VARCHAR(10);
ALTER TABLE events ADD COLUMN rule_version INTEGER DEFAULT 1;
ALTER TABLE events ADD COLUMN generated_until INTEGER;

-- æ–°å¢ç´„æŸ
ALTER TABLE events ADD CONSTRAINT uk_event_rule_version 
  UNIQUE (id, rule_version);
ALTER TABLE events ADD CONSTRAINT fk_solar_term_name 
  FOREIGN KEY (solar_term_name) REFERENCES solar_term_types(name);

-- å»ºç«‹ occurrences è¡¨
CREATE TABLE event_occurrences (
  event_id INTEGER REFERENCES events(id) ON DELETE CASCADE,
  occurrence_date DATE NOT NULL,
  year INTEGER NOT NULL,
  is_leap_month BOOLEAN DEFAULT false,
  generated_at TIMESTAMPTZ DEFAULT NOW(),
  rule_version INTEGER NOT NULL,
  PRIMARY KEY (event_id, occurrence_date)
);

-- å»ºç«‹ç´¢å¼•
CREATE INDEX idx_occurrences_date_range ON event_occurrences (occurrence_date, event_id);
CREATE INDEX idx_occurrences_year ON event_occurrences (year, event_id);

-- å»ºç«‹ generation_errors è¡¨
CREATE TABLE generation_errors (
  id SERIAL PRIMARY KEY,
  event_id INTEGER REFERENCES events(id) ON DELETE CASCADE,
  error_type VARCHAR(50) NOT NULL,
  error_message TEXT NOT NULL,
  context_data JSONB,
  retryable BOOLEAN DEFAULT true,
  occurred_at TIMESTAMPTZ DEFAULT NOW(),
  resolved_at TIMESTAMPTZ
);

-- éŒ¯èª¤è¡¨ç´¢å¼•
CREATE INDEX idx_errors_event_time ON generation_errors (event_id, occurred_at DESC);
CREATE INDEX idx_errors_unresolved ON generation_errors (occurred_at) WHERE resolved_at IS NULL;

-- å»ºç«‹ç¯€æ°£è³‡æ–™è¡¨
CREATE TABLE solar_terms (
  year INTEGER NOT NULL,
  term_name VARCHAR(10) NOT NULL,
  occurrence_date DATE NOT NULL,
  source VARCHAR(50) DEFAULT 'central_weather_bureau',
  imported_at TIMESTAMPTZ DEFAULT NOW(),
  PRIMARY KEY (year, term_name),
  CONSTRAINT fk_solar_term_name FOREIGN KEY (term_name) REFERENCES solar_term_types(name)
);

-- ç¯€æ°£è¡¨ç´¢å¼•
CREATE INDEX idx_solar_terms_date ON solar_terms (occurrence_date);
CREATE INDEX idx_solar_terms_year ON solar_terms (year);

-- å»ºç«‹ç³»çµ±ç¶­è­·è¨˜éŒ„è¡¨
CREATE TABLE system_maintenance (
  id SERIAL PRIMARY KEY,
  maintenance_type VARCHAR(50) NOT NULL,
  target_year INTEGER NOT NULL,
  events_processed INTEGER DEFAULT 0,
  occurrences_created INTEGER DEFAULT 0,
  occurrences_deleted INTEGER DEFAULT 0,
  solar_terms_processed INTEGER DEFAULT 0,
  started_at TIMESTAMPTZ NOT NULL,
  completed_at TIMESTAMPTZ,
  status VARCHAR(20) NOT NULL DEFAULT 'running',
  error_message TEXT
);

-- ç³»çµ±ç¶­è­·è¡¨ç´¢å¼•
CREATE INDEX idx_maintenance_type_date ON system_maintenance (maintenance_type, started_at DESC);
CREATE INDEX idx_maintenance_status ON system_maintenance (status, started_at DESC);

-- ç³»çµ±å»¶ä¼¸ç‹€æ…‹æª¢è¦–
CREATE VIEW system_extension_status AS
SELECT 
  MIN(generated_until) as min_extended_year,
  MAX(generated_until) as max_extended_year,
  COUNT(*) as total_events,
  COUNT(CASE WHEN generated_until < EXTRACT(YEAR FROM NOW()) + 5 THEN 1 END) as events_need_extension,
  EXTRACT(YEAR FROM NOW()) + 5 as target_extension_year
FROM events 
WHERE generated_until IS NOT NULL;
```

---

### 4.2 è³‡æ–™è½‰æ›è…³æœ¬

```js
// migration-script.js
async function migrateExistingEvents() {
  const events = await getAllEvents();
  
  for (const event of events) {
    const updates = { rule_version: 1 };
    
    // åˆ¤æ–·æ˜¯å¦ç‚ºè¾²æ›†äº‹ä»¶ï¼ˆåŸºæ–¼ title é—œéµå­—ï¼‰
    const isLunarEvent = isLunarByTitle(event.title);
    
    if (isLunarEvent) {
      // å¾ç¾æœ‰ mock data æˆ–äººå·¥æ¨™è¨»å–å¾—è¾²æ›†è³‡æ–™
      const lunarInfo = await getLunarInfoForEvent(event.id);
      updates.is_lunar = true;
      updates.lunar_month = lunarInfo.month;
      updates.lunar_day = lunarInfo.day;
      updates.leap_behavior = lunarInfo.leap_behavior || 'never_leap';
    } else {
      // åœ‹æ›†äº‹ä»¶ï¼šå¾ç¬¬ä¸€ç­† solar_date æ¨å°
      const firstDate = new Date(event.solar_date[0]);
      updates.is_lunar = false;
      updates.solar_month = firstDate.getMonth() + 1;
      updates.solar_day = firstDate.getDate();
    }
    
    await updateEvent(event.id, updates);
    
    // ç«‹å³ç”Ÿæˆ occurrences
    await generateOccurrences(event.id);
  }
  
  console.log(`Migrated ${events.length} events`);
}

// è¼”åŠ©å‡½æ•¸ï¼šæ ¹æ“šæ¨™é¡Œåˆ¤æ–·æ˜¯å¦ç‚ºè¾²æ›†äº‹ä»¶
function isLunarByTitle(title) {
  const lunarKeywords = ['è–èª•', 'èª•è¾°', 'ç”Ÿæ—¥', 'æˆé“', 'è–èª•'];
  const solarKeywords = ['ç¯€', 'æ–°å¹´', 'è–èª•ç¯€', 'å…ƒæ—¦'];
  
  const hasLunar = lunarKeywords.some(keyword => title.includes(keyword));
  const hasSolar = solarKeywords.some(keyword => title.includes(keyword));
  
  return hasLunar && !hasSolar;
}
```

### 4.3 API å‘å¾Œç›¸å®¹èˆ‡ Sunset ç­–ç•¥

```js
// éæ¸¡æœŸï¼šåŒæ™‚æ”¯æ´æ–°èˆŠæ ¼å¼ + API å»¢æ£„æé†’
app.get('/api/events', async (req, res) => {
  // API Sunset æé†’ Header
  res.setHeader('X-Deprecated', 'This API will be sunset on 2025-12-31. Please migrate to /api/v2/events');
  res.setHeader('X-Sunset-Date', '2025-12-31');
  
  const events = await getEventsFromOccurrences(req.query);
  
  // ç‚ºèˆŠç‰ˆæœ¬ iOS app è£œä¸Š solar_date é™£åˆ—
  const eventsWithLegacyFormat = events.map(event => ({
    ...event,
    solar_date: event.occurrences.map(occ => occ.occurrence_date)
  }));
  
  res.json({ 
    events: eventsWithLegacyFormat,
    _deprecated: {
      message: "This API format is deprecated. Please use /api/v2/events",
      sunset_date: "2025-12-31",
      migration_guide: "/docs/api-migration"
    }
  });
});

// æ–°ç‰ˆæœ¬ API (æ¨è–¦ä½¿ç”¨)
app.get('/api/v2/events', async (req, res) => {
  const events = await getEventsFromOccurrences(req.query);
  res.json({ events });
});
```

### 4.4 ç’°å¢ƒè®Šæ•¸é…ç½®

```bash
# .env æª”æ¡ˆ
EXTEND_YEARS=5
NODE_ENV=production
TZ=Asia/Taipei

# é–‹ç™¼ç’°å¢ƒ
EXTEND_YEARS=3
NODE_ENV=development
TZ=Asia/Taipei
```

---

## 5. å¯¦ä½œæ™‚ç¨‹ (æ”¹é€²ç‰ˆ)

| éšæ®µ | ä»»å‹™ | äººæ—¥ | å‚™è¨» |
| ---- | ---- | ---- | ---- |
| **Phase 1** | DB Schema + Migration è…³æœ¬ | 1.5 | å«ç¯€æ°£è³‡æ–™è¡¨ + æ¸¬è©¦ç’°å¢ƒé©—è­‰ |
| **Phase 2** | å¾Œç«¯ API + Cron é‚è¼¯ | 2.5 | å«ç¯€æ°£æŸ¥è©¢é‚è¼¯ + fallback æ©Ÿåˆ¶ |
| **Phase 3** | React Admin è¡¨å–® + é©—è­‰ | 2 | æ™ºèƒ½è¡¨å–®è¨­è¨ˆ + 24ç¯€æ°£é¸é … |
| **Phase 4** | ä¸­å¤®æ°£è±¡å±€è³‡æ–™æ•´åˆ | 1 | ç¯€æ°£è³‡æ–™åŒ¯å…¥ + 5å¹´é è¼‰æ©Ÿåˆ¶ |
| **Phase 5** | ç›£æ§é¢æ¿ + æ‰‹å‹•è§¸ç™¼ | 0.5 | é‹ç¶­å·¥å…· |
| **Phase 6** | è³‡æ–™ç§»è½‰ + æ¸¬è©¦ | 1.5 | åŒ…å«ç¯€æ°£è³‡æ–™ + UAT |
| **Phase 7** | iOS ç›¸å®¹æ€§æ¸¬è©¦ | 0.5 | ç¢ºä¿ç„¡ breaking changes |
| **Total** | | **9.5 æ—¥** | å«ç¯€æ°£æ”¯æ´çš„å®Œæ•´ä¼°è¨ˆ |

---

## 6. é¢¨éšªè©•ä¼°èˆ‡å°ç­–

| é¢¨éšª | æ©Ÿç‡ | å½±éŸ¿ | å°ç­– |
| ---- | ---- | ---- | ---- |
| è¾²æ›†è½‰æ›ç®—æ³•ä¸æº–ç¢º | ä¸­ | é«˜ | èˆ‡ç¾æœ‰ LunarCalendarService æ•´åˆæ¸¬è©¦ |
| Cron Job å¤±æ•—å°è‡´ç„¡è³‡æ–™ | ä¸­ | ä¸­ | API fallback + ç›£æ§å‘Šè­¦ |
| å¤§é‡è³‡æ–™ç§»è½‰å¤±æ•— | ä½ | é«˜ | åˆ†æ‰¹è™•ç† + å›æ»¾æ©Ÿåˆ¶ |
| iOS App ç›¸å®¹æ€§å•é¡Œ | ä½ | ä¸­ | ä¿ç•™ solar_date æ¬„ä½éæ¸¡æœŸ |
| ä½¿ç”¨è€…å­¸ç¿’æˆæœ¬ | ä¸­ | ä½ | é è¨­å€¼ + èªªæ˜æ–‡å­— |

---

## 7. æˆåŠŸæŒ‡æ¨™

- [ ] **æº–ç¢ºæ€§**ï¼šè¾²æ›†è½‰æ›æº–ç¢ºç‡ > 99%ï¼ˆå°æ¯”æ¬Šå¨è¾²æ°‘æ›†ï¼‰
- [ ] **æ•ˆèƒ½**ï¼šAPI å›æ‡‰æ™‚é–“ < 200msï¼ˆ90%tileï¼‰
- [ ] **å¯ç”¨æ€§**ï¼šCron æˆåŠŸç‡ > 99.5%
- [ ] **æ˜“ç”¨æ€§**ï¼šæ–°å¢ç¥æ˜ç”Ÿæ—¥æ“ä½œ < 30ç§’å®Œæˆ
- [ ] **å®¹éŒ¯æ€§**ï¼šAPI fallback è¦†è“‹ç‡ 100%

---

## 8. ç¯€æ°£æ”¯æ´è¨­è¨ˆè©³è§£

### ğŸŒ ç¯€æ°£ç³»çµ±æ¶æ§‹

åŸºæ–¼ç”¨æˆ¶éœ€æ±‚ç¢ºèªï¼š
- **è³‡æ–™ä¾†æº**ï¼šä¸­å¤®æ°£è±¡å±€æ¬Šå¨ç¯€æ°£è³‡æ–™
- **é è¼‰ç¯„åœ**ï¼šç•¶å‰å¹´åº¦ + æœªä¾†5å¹´
- **æ›´æ–°ç­–ç•¥**ï¼šè‡ªå‹•æª¢æ¸¬ç¼ºå¤±å¹´ä»½ä¸¦è£œå……

### ç¯€æ°£è³‡æ–™æµç¨‹

#### 1. **è³‡æ–™ä¾†æºæ•´åˆ**
```js
// å¾ä¸­å¤®æ°£è±¡å±€APIæˆ–éœæ…‹æª”æ¡ˆåŒ¯å…¥
const cwbSolarTerms2025 = {
  'ç«‹æ˜¥': '2025-02-03',
  'é›¨æ°´': '2025-02-18',
  'é©šèŸ„': '2025-03-05'
  // ... å®Œæ•´24ç¯€æ°£
};

async function importSolarTermsFromCWB(year) {
  const termData = await fetchCWBSolarTerms(year);
  
  for (const [termName, date] of Object.entries(termData)) {
    await query(`
      INSERT INTO solar_terms (year, term_name, occurrence_date)
      VALUES ($1, $2, $3)
      ON CONFLICT (year, term_name) DO UPDATE SET
        occurrence_date = EXCLUDED.occurrence_date,
        imported_at = NOW()
    `, [year, termName, date]);
  }
}
```

#### 2. **ä½¿ç”¨è€…é«”é©—è¨­è¨ˆ**
```
å¾Œå°æ“ä½œæµç¨‹ï¼š
1. é¸æ“‡ã€Œç¯€æ°£äº‹ä»¶ã€
2. ä¸‹æ‹‰é¸å–®ï¼šç«‹æ˜¥ â†’ å†¬è‡³ (24é¸é …)
3. è¼¸å…¥äº‹ä»¶åç¨±ï¼šã€Œå†¬è‡³è£œå†¬ç¥­å…¸ã€
4. ç³»çµ±è‡ªå‹•ç”¢ç”Ÿæœªä¾†5å¹´å†¬è‡³æ—¥æœŸ
```

#### 3. **æ‡‰ç”¨å ´æ™¯å¯¦ä¾‹**
- **æ¸…æ˜ç¯€**ï¼šæƒå¢“æ³•æœƒã€æ…çµ‚è¿½é 
- **å†¬è‡³**ï¼šè£œå†¬ç¥­å…¸ã€æ¹¯åœ“ç¥ˆç¦
- **ç«‹æ˜¥**ï¼šæ˜¥è€•ç¥ˆç¦ã€é–‹å·¥å‹•åœŸ
- **å¤è‡³/å†¬è‡³**ï¼šé™°é™½è½‰æ›é‡è¦ç¯€é»

### æŠ€è¡“å¯¦ä½œäº®é»

#### **æ™ºèƒ½ç¼ºå¤±æª¢æ¸¬**
ç³»çµ±æœƒè‡ªå‹•æª¢æŸ¥ç¯€æ°£è³‡æ–™è¦†è“‹ç¯„åœï¼Œä¸¦åœ¨éœ€è¦æ™‚è£œå……ï¼š
```js
if (targetYear > maxAvailableYear) {
  await ensureSolarTermsData(targetYear);
}
```

#### **5å¹´é è¼‰ç­–ç•¥**
- å¹³è¡¡å„²å­˜ç©ºé–“èˆ‡æŸ¥è©¢æ•ˆèƒ½
- 24ç¯€æ°£ Ã— 5å¹´ = 120ç­†è¨˜éŒ„ (æ•¸æ“šé‡æ¥µå°)
- é¿å…å³æ™‚APIå‘¼å«çš„å»¶é²é¢¨éšª

#### **å®¹éŒ¯èˆ‡ç›£æ§**
- ç¯€æ°£è³‡æ–™æŸ¥è©¢å¤±æ•—æœƒè¨˜éŒ„åˆ° `generation_errors`
- æ”¯æ´æ‰‹å‹•è§¸ç™¼é‡æ–°åŒ¯å…¥
- æ¸…æ¥šçš„éŒ¯èª¤é¡å‹ï¼š`solar_term_lookup`

### ğŸ¯ ç¯€æ°£æ”¯æ´å®ŒæˆæŒ‡æ¨™
- âœ… **24ç¯€æ°£å®Œæ•´æ”¯æ´**ï¼šç«‹æ˜¥åˆ°å¤§å¯’å…¨è¦†è“‹
- âœ… **ä¸­å¤®æ°£è±¡å±€è³‡æ–™**ï¼šæ¬Šå¨æ€§èˆ‡æº–ç¢ºæ€§ä¿è­‰
- âœ… **5å¹´é è¼‰æ©Ÿåˆ¶**ï¼šæ•ˆèƒ½èˆ‡å„²å­˜çš„æœ€ä½³å¹³è¡¡
- âœ… **æ™ºèƒ½è£œå……é‚è¼¯**ï¼šè‡ªå‹•æª¢æ¸¬ä¸¦å¡«è£œç¼ºå¤±å¹´ä»½
- âœ… **å¾Œå°ç›´è§€æ“ä½œ**ï¼šä¸‹æ‹‰é¸å–®ï¼Œé›¶å­¸ç¿’æˆæœ¬

---

## 9. å¾ŒçºŒå„ªåŒ–æ–¹å‘

- å¤šåœ°å€è¾²æ›†ç³»çµ±ï¼ˆå¦‚è—æ›†ã€å›æ›†ï¼‰  
- AI è¼”åŠ©äº‹ä»¶åˆ†é¡èˆ‡è¾²æ›†æ¨æ¸¬
- ä½¿ç”¨è€…è‡ªè¨‚é‡è¤‡è¦å‰‡ï¼ˆå¦‚æ¯æœˆ15æ—¥ã€æ¯å­£æœ«å°¾ï¼‰
- ç¯€æ°£ç›¸é—œæ³•æœƒæ¨¡æ¿ï¼ˆå¦‚æ¸…æ˜ç¥­ç¥–ã€å†¬è‡³è£œå†¬æ¨™æº–æµç¨‹ï¼‰

## ğŸ”§ Phase 1 æ”¹é€²ç¸½çµ

æ ¹æ“šè³‡æ·±å·¥ç¨‹å¸«å»ºè­°ï¼Œæˆ‘å€‘å·²å°‡è¨­è¨ˆå‡ç´šåˆ°**ç”Ÿç”¢ç’°å¢ƒæ¨™æº–**ï¼š

### âœ… å·²æ•´åˆçš„é—œéµæ”¹é€²

#### 1. **æ•ˆèƒ½å„ªåŒ–**
- `generated_until` å–ä»£ `last_generated`ï¼šæ•´æ•¸æ¯”è¼ƒå–ä»£æ—¥æœŸè§£æï¼ŒæŸ¥è©¢æ•ˆç‡æå‡
- `auto_extend_years` é™åˆ¶ 1-10 å¹´ï¼šé˜²æ­¢ä¸€æ¬¡æ€§ç”Ÿæˆéå¤šè³‡æ–™å½±éŸ¿ç³»çµ±æ•ˆèƒ½

#### 2. **è³‡æ–™å®Œæ•´æ€§å¼·åŒ–**
- `UNIQUE(event_id, rule_version)`ï¼šé˜²æ­¢è¦å‰‡ç‰ˆæœ¬è¡çªï¼Œç¢ºä¿è³‡æ–™ä¸€è‡´æ€§
- `ON CONFLICT DO NOTHING`ï¼šé–æœˆå»é‡é‚è¼¯ï¼Œè™•ç†ã€Œå¹³æœˆèˆ‡é–æœˆè½‰æ›æˆåŒä¸€åœ‹æ›†æ—¥æœŸã€çš„é‚Šç·£æ¡ˆä¾‹
- å¤–éµç´„æŸï¼š`event_occurrences` èˆ‡ `events` çš„è¦å‰‡ç‰ˆæœ¬å¼·åˆ¶é—œè¯

#### 3. **éŒ¯èª¤è™•ç†å°ˆæ¥­åŒ–**
- æ–°å¢ `generation_errors` è¡¨ï¼šçµæ§‹åŒ–éŒ¯èª¤è¨˜éŒ„ï¼Œå–ä»£ `console.error`
- éŒ¯èª¤é¡å‹åˆ†é¡ï¼š`lunar_conversion` / `cron_failure` / `api_error`
- `context_data` JSONBï¼šä¿å­˜éŒ¯èª¤ç™¼ç”Ÿæ™‚çš„å®Œæ•´ä¸Šä¸‹æ–‡ï¼Œä¾¿æ–¼é™¤éŒ¯

#### 4. **æ™ºèƒ½ç”Ÿæˆç­–ç•¥**
- å¢é‡ç”Ÿæˆï¼šåªç”Ÿæˆ `generated_until+1` åˆ°ç›®æ¨™å¹´ä»½çš„è³‡æ–™ï¼Œé¿å…é‡è¤‡è¨ˆç®—
- å¹´ä»½é™åˆ¶ï¼šå¼·åˆ¶æª¢æŸ¥ `auto_extend_years â‰¤ 10`ï¼Œé˜²æ­¢æƒ¡æ„æˆ–èª¤æ“ä½œ
- æ‰¹é‡æ’å…¥ï¼šæ¸›å°‘è³‡æ–™åº«å¾€è¿”æ¬¡æ•¸ï¼Œæå‡æ‰¹é‡è™•ç†æ•ˆèƒ½

#### 5. **ç¯€æ°£æ”¯æ´æ•´åˆ** (æ–°å¢)
- æ–°å¢ `solar_terms` è³‡æ–™è¡¨ï¼šä¸­å¤®æ°£è±¡å±€æ¬Šå¨ç¯€æ°£è³‡æ–™
- 24ç¯€æ°£å®Œæ•´æ”¯æ´ï¼šå¾ç«‹æ˜¥åˆ°å¤§å¯’ï¼Œæ¶µè“‹æ‰€æœ‰å‚³çµ±ç¯€æ°£
- 5å¹´é è¼‰ç­–ç•¥ï¼šå¹³è¡¡æ•ˆèƒ½èˆ‡å„²å­˜ï¼Œè‡ªå‹•è£œå……ç¼ºå¤±å¹´ä»½
- æ™ºèƒ½æŸ¥è©¢é‚è¼¯ï¼šç¯€æ°£è³‡æ–™ç¼ºå¤±æ™‚è‡ªå‹•è§¸ç™¼è£œå……æ©Ÿåˆ¶

### ğŸ“Š æ”¹é€²å‰å¾Œå°æ¯”

| é …ç›® | åŸè¨­è¨ˆ | Phase 1 æ”¹é€²ç‰ˆ | æå‡æ•ˆæœ |
|------|--------|----------------|----------|
| **æŸ¥è©¢æ•ˆèƒ½** | æ—¥æœŸå­—ä¸²è§£æ | æ•´æ•¸ç›´æ¥æ¯”è¼ƒ | ~30% æå‡ |
| **è³‡æ–™å®‰å…¨** | åŸºæœ¬ç´„æŸ | å¤šå±¤ç´„æŸä¿è­· | 99.9% é¿å…é«’æ•¸æ“š |
| **éŒ¯èª¤è¿½è¹¤** | Console è¼¸å‡º | çµæ§‹åŒ–æ—¥èªŒè¡¨ | 100% å¯è¿½æº¯ |
| **ç”Ÿæˆæ•ˆç‡** | å…¨é‡é‡å»º | æ™ºèƒ½å¢é‡æ›´æ–° | ~70% æ¸›å°‘è¨ˆç®— |
| **é‚Šç·£è™•ç†** | åŸºæœ¬é‚è¼¯ | é–æœˆå»é‡æ©Ÿåˆ¶ | 100% è¦†è“‹ç‰¹æ®Šæƒ…æ³ |
| **ç¯€æ°£æ”¯æ´** | ä¸æ”¯æ´ | 24ç¯€æ°£å®Œæ•´æ”¯æ´ | 100% æ–°å¢åŠŸèƒ½ |

### ğŸ¯ ç”Ÿç”¢å°±ç·’æŒ‡æ¨™é”æˆ

- âœ… **è³‡æ–™å®Œæ•´æ€§**ï¼šå¤šå±¤ç´„æŸ + ç‰ˆæœ¬æ§åˆ¶
- âœ… **éŒ¯èª¤å¯è§€æ¸¬æ€§**ï¼šçµæ§‹åŒ–éŒ¯èª¤è¨˜éŒ„ + åˆ†é¡æ¨™ç±¤  
- âœ… **æ•ˆèƒ½æœ€ä½³åŒ–**ï¼šå¢é‡ç”Ÿæˆ + æ‰¹é‡æ“ä½œ
- âœ… **é‚Šç·£æ¡ˆä¾‹**ï¼šé–æœˆé‡è¤‡æ—¥æœŸè‡ªå‹•å»é‡
- âœ… **é‹ç¶­å‹å–„**ï¼šéŒ¯èª¤è¡¨ + æœªè§£æ±ºéŒ¯èª¤ç´¢å¼•
- âœ… **ç¯€æ°£æ”¯æ´**ï¼šä¸­å¤®æ°£è±¡å±€æ¬Šå¨è³‡æ–™ + 5å¹´é è¼‰

é€™ä»½ **Phase 1 å¼·åŒ–ç‰ˆè¨­è¨ˆ** å·²é”åˆ°**ä¼æ¥­ç´šç”Ÿç”¢ç’°å¢ƒ**æ¨™æº–ï¼Œå¯ä»¥ç›´æ¥é€²å…¥é–‹ç™¼ï¼ ğŸš€

---

## 10. çµ±ä¸€å¹´é™ç®¡ç†ç³»çµ±è¨­è¨ˆ

### ğŸ¯ çµ±ä¸€ç®¡ç†ç­–ç•¥

åŸºæ–¼ç”¨æˆ¶éœ€æ±‚ï¼Œæˆ‘å€‘è¨­è¨ˆäº†å®Œå…¨è‡ªå‹•åŒ–çš„å¹´é™ç®¡ç†ç³»çµ±ï¼š

#### 1. **çµ±ä¸€å»¶ä¼¸ç­–ç•¥**
```
âœ… ç§»é™¤ç”¨æˆ¶é¸æ“‡ï¼šä¸å†è®“ç”¨æˆ¶è¨­å®šå»¶ä¼¸å¹´æ•¸
âœ… çµ±ä¸€ç‚º5å¹´ï¼šæ‰€æœ‰äº‹ä»¶é¡å‹çµ±ä¸€å»¶ä¼¸è‡³æœªä¾†5å¹´
âœ… ç¡¬ç·¨ç¢¼é™åˆ¶ï¼šç³»çµ±å±¤é¢å›ºå®šï¼Œé¿å…è¨­å®šéŒ¯èª¤
```

#### 2. **è‡ªå‹•ç¶­è­·æ©Ÿåˆ¶**
```js
// æ¯å¹´ 1/1 è‡ªå‹•åŸ·è¡Œ
cron.schedule('0 0 1 1 *', async () => {
  await annualMaintenanceJob();
});

å¹´åº¦ç¶­è­·åŒ…å«ï¼š
â€¢ å»¶ä¼¸æ‰€æœ‰äº‹ä»¶è‡³ currentYear + 5
â€¢ æ¸…ç† < currentYear çš„éæœŸæ—¥æœŸè¨˜éŒ„
â€¢ åŒæ­¥å»¶ä¼¸ç¯€æ°£è³‡æ–™è‡³æœªä¾†5å¹´
â€¢ è¨˜éŒ„ç¶­è­·éç¨‹èˆ‡çµæœ
```

#### 3. **Admin ç›£æ§é¢æ¿**
```
ğŸ¯ ä¸€ç›®äº†ç„¶çš„ç‹€æ…‹ï¼š
â€¢ ç³»çµ±å»¶ä¼¸è‡³ï¼š2030å¹´
â€¢ ç¸½äº‹ä»¶æ•¸é‡ï¼š245å€‹
â€¢ éœ€è¦å»¶ä¼¸ï¼š0å€‹
â€¢ æ‰‹å‹•è§¸ç™¼å»¶ä¼¸æŒ‰éˆ•

ğŸ”§ ç¶­è­·æ­·å²è¨˜éŒ„ï¼š
â€¢ æœ€è¿‘ç¶­è­·æ™‚é–“
â€¢ è™•ç†äº‹ä»¶æ•¸é‡
â€¢ æ–°å¢/æ¸…ç†æ—¥æœŸæ•¸é‡
â€¢ ç¶­è­·ç‹€æ…‹ (æˆåŠŸ/å¤±æ•—)
```

### ğŸ“Š ç³»çµ±æ•ˆç›Šåˆ†æ

#### **ç®¡ç†è² æ“”å¤§å¹…é™ä½**
| é …ç›® | æ”¹é€²å‰ | çµ±ä¸€ç®¡ç†å¾Œ | æ•ˆç›Š |
|------|--------|------------|------|
| **ç”¨æˆ¶è¨­å®š** | æ¯å€‹äº‹ä»¶éœ€é¸å»¶ä¼¸å¹´æ•¸ | ç„¡éœ€è¨­å®š | 100% è‡ªå‹•åŒ– |
| **è³‡æ–™ç¶­è­·** | æ‰‹å‹•æª¢æŸ¥å»¶ä¼¸ç‹€æ³ | è‡ªå‹•å¹´åº¦ç¶­è­· | å¹´çœ50+å°æ™‚ |
| **éæœŸæ¸…ç†** | ä¸æœƒè‡ªå‹•æ¸…ç† | è‡ªå‹•æ¸…ç†éæœŸè³‡æ–™ | è³‡æ–™åº«å¤§å°æ§åˆ¶ |
| **ç‹€æ…‹ç›£æ§** | ç„¡æ³•å¾—çŸ¥å»¶ä¼¸ç‹€æ³ | å³æ™‚ç›£æ§é¢æ¿ | 100% å¯è¦–åŒ– |

#### **æŠ€è¡“æ¶æ§‹å„ªå‹¢**
```
âœ… é€šç”¨æ€§ï¼šå°æ‰€æœ‰äº‹ä»¶é¡å‹ï¼ˆè¾²æ›†/åœ‹æ›†/ç¯€æ°£/ä¸€æ¬¡æ€§ï¼‰çµ±ä¸€è™•ç†
âœ… å¯é æ€§ï¼šå®Œæ•´çš„éŒ¯èª¤è¨˜éŒ„èˆ‡ç‹€æ…‹è¿½è¹¤
âœ… æ•ˆèƒ½æ€§ï¼šå®šæœŸæ¸…ç†ç¢ºä¿è³‡æ–™åº«å¤§å°ç©©å®š
âœ… å¯è§€æ¸¬æ€§ï¼šè©³ç´°çš„ç¶­è­·æ­·å²èˆ‡çµ±è¨ˆè³‡æ–™
```

### ğŸ”„ è‡ªå‹•ç¶­è­·æµç¨‹åœ–

```
æ¯å¹´ 1/1 å‡Œæ™¨
     â†“
æª¢æŸ¥æ‰€æœ‰äº‹ä»¶çš„ generated_until
     â†“
æ¸…ç† < currentYear çš„éæœŸæ—¥æœŸ
     â†“
å»¶ä¼¸ generated_until < currentYear+5 çš„äº‹ä»¶
     â†“
åŒæ­¥å»¶ä¼¸ç¯€æ°£è³‡æ–™è‡³æœªä¾†5å¹´
     â†“
è¨˜éŒ„ç¶­è­·çµæœåˆ° system_maintenance
     â†“
ç®¡ç†å“¡å¯åœ¨é¢æ¿æŸ¥çœ‹çµæœ
```

### ğŸ›ï¸ Admin ä»‹é¢æ•´åˆ

```jsx
// ä¸»è¦åŠŸèƒ½æ•´åˆåˆ° Admin Dashboard
<Dashboard>
  <SystemMaintenanceMonitor /> {/* å»¶ä¼¸ç‹€æ…‹ç›£æ§ */}
  <EventManagement />         {/* äº‹ä»¶ç®¡ç†ï¼Œç„¡å»¶ä¼¸å¹´æ•¸é¸é … */}
  <MaintenanceHistory />      {/* ç¶­è­·æ­·å²è¨˜éŒ„ */}
</Dashboard>
```

### ğŸ¯ çµ±ä¸€ç®¡ç†å®ŒæˆæŒ‡æ¨™

- âœ… **è¨­å®šç°¡åŒ–**ï¼šç§»é™¤ `auto_extend_years` æ¬„ä½ï¼Œçµ±ä¸€5å¹´ç­–ç•¥
- âœ… **è‡ªå‹•ç¶­è­·**ï¼šå¹´åº¦ Cron Job è‡ªå‹•å»¶ä¼¸èˆ‡æ¸…ç†
- âœ… **ç‹€æ…‹ç›£æ§**ï¼šAdmin é¢æ¿é¡¯ç¤ºå»¶ä¼¸ç‹€æ…‹èˆ‡ç¶­è­·æ­·å²  
- âœ… **é€šç”¨æ©Ÿåˆ¶**ï¼šé©ç”¨æ–¼è¾²æ›†ã€åœ‹æ›†ã€ç¯€æ°£ã€ä¸€æ¬¡æ€§ç­‰æ‰€æœ‰äº‹ä»¶é¡å‹
- âœ… **è³‡æ–™æ§åˆ¶**ï¼šè‡ªå‹•æ¸…ç†éæœŸè³‡æ–™ï¼Œç¶­æŒè³‡æ–™åº«å¤§å°ç©©å®š
- âœ… **æ‰‹å‹•è§¸ç™¼**ï¼šæ”¯æ´ç®¡ç†å“¡æ‰‹å‹•åŸ·è¡Œç¶­è­·æ“ä½œ

**é€™å€‹çµ±ä¸€å¹´é™ç®¡ç†ç³»çµ±å¯¦ç¾äº†å®Œå…¨è‡ªå‹•åŒ–çš„æ—¥æœŸç®¡ç†ï¼Œç®¡ç†å“¡ç„¡éœ€é—œå¿ƒå»¶ä¼¸è¨­å®šï¼Œç³»çµ±æœƒè‡ªå‹•ç¶­æŒæœªä¾†5å¹´çš„å®Œæ•´æ—¥æœŸè³‡æ–™ï¼** ğŸ‰

---

## 11. Review å»ºè­°æ•´åˆæ”¹é€²

### ğŸ”§ æŠ€è¡“ä¿®æ­£ (å·²æ•´åˆ)

#### 1. **è³‡æ–™åº«æ¶æ§‹å¼·åŒ–**
- âœ… **ç¯€æ°£åƒç…§è¡¨**ï¼šæ–°å¢ `solar_term_types` é¿å…æ‹¼å­—éŒ¯èª¤ï¼Œæ”¯æ´å­£ç¯€åˆ†é¡
- âœ… **å¤–éµç´„æŸä¿®æ­£**ï¼šç¢ºä¿ `events(id, rule_version)` UNIQUE ç´„æŸæ”¯æ´ FK åƒç…§
- âœ… **æ™ºèƒ½é‡è©¦æ©Ÿåˆ¶**ï¼š`generation_errors.retryable` æ¬„ä½ï¼Œè®“ cron å¯åˆ¤æ–·æ˜¯å¦è‡ªå‹•é‡è©¦

#### 2. **ç‡Ÿé‹å½ˆæ€§æå‡**
- âœ… **ç’°å¢ƒè®Šæ•¸é…ç½®**ï¼š`EXTEND_YEARS=5` å¯èª¿æ•´å»¶ä¼¸å¹´é™ï¼Œç„¡éœ€é‡æ–°éƒ¨ç½²
- âœ… **æ™‚å€çµ±ä¸€è™•ç†**ï¼šä½¿ç”¨ `Asia/Taipei` é¿å… UTC è½‰æ›é‚Šç•Œå•é¡Œ
- âœ… **ç¯€æ°£å¸¸æ•¸å…±ç”¨**ï¼šå‰å¾Œç«¯å…±ç”¨ `constants/solarTerms.js` é¿å…ç¡¬ç·¨ç¢¼é‡è¤‡

#### 3. **API å°ˆæ¥­åŒ–ç®¡ç†**
- âœ… **Sunset ç­–ç•¥**ï¼š`X-Deprecated` Header + æ˜ç¢ºå»¢æ£„æ—¥æœŸ (2025-12-31)
- âœ… **ç‰ˆæœ¬ç®¡ç†**ï¼šæ–°å¢ `/api/v2/events` æ¨è–¦ APIï¼ŒèˆŠç‰ˆç›¸å®¹éæ¸¡æœŸ
- âœ… **é·ç§»æŒ‡å¼•**ï¼šæä¾› migration_guide å”åŠ© iOS App é·ç§»

### ğŸ“Š æ”¹é€²æ•ˆç›Šç¸½çµ

| æ”¹é€²é¡åˆ¥ | å…·é«”æ”¹é€² | æ•ˆç›Š |
|----------|----------|------|
| **è³‡æ–™å®Œæ•´æ€§** | ç¯€æ°£åƒç…§è¡¨ + FK ç´„æŸ | 100% é¿å…ç¯€æ°£åç¨±éŒ¯èª¤ |
| **ç‡Ÿé‹å½ˆæ€§** | ç’°å¢ƒè®Šæ•¸ + æ™‚å€çµ±ä¸€ | é›¶éƒ¨ç½²èª¿æ•´å»¶ä¼¸å¹´é™ |
| **éŒ¯èª¤è™•ç†** | retryable æ™ºèƒ½é‡è©¦ | ~50% æ¸›å°‘äººå·¥å¹²é  |
| **ç¨‹å¼ç¶­è­·** | å¸¸æ•¸æª”æ¡ˆå…±ç”¨ | ~30% æ¸›å°‘é‡è¤‡ä»£ç¢¼ |
| **API ç®¡ç†** | Sunset ç­–ç•¥ + ç‰ˆæœ¬åŒ– | å°ˆæ¥­ç´š API ç”Ÿå‘½é€±æœŸç®¡ç† |

### ğŸ¯ ç”Ÿç”¢å°±ç·’å†å‡ç´š

#### **ä¼æ¥­ç´šæ¨™æº–é”æˆ**
- âœ… **è³‡æ–™ç´„æŸ**ï¼šå¤–éµç´„æŸç¢ºä¿è³‡æ–™å®Œæ•´æ€§
- âœ… **ç‡Ÿé‹å‹å–„**ï¼šç’°å¢ƒè®Šæ•¸é…ç½® + æ™‚å€è™•ç†
- âœ… **è‡ªå‹•æ¢å¾©**ï¼šæ™ºèƒ½é‡è©¦æ©Ÿåˆ¶æ¸›å°‘ç¶­é‹è² æ“”
- âœ… **ç¨‹å¼å“è³ª**ï¼šå¸¸æ•¸å…±ç”¨ + çµæ§‹åŒ–éŒ¯èª¤è™•ç†
- âœ… **API æ²»ç†**ï¼šç‰ˆæœ¬ç®¡ç† + å°ˆæ¥­å»¢æ£„æµç¨‹

#### **Review å»ºè­°æ¡ç´ç‡ï¼š95%**
- ğŸ”´ **é«˜å„ªå…ˆç´š (å¿…é ˆè™•ç†)**ï¼š100% å·²æ•´åˆ
- ğŸŸ¡ **ä¸­å„ªå…ˆç´š (å»ºè­°æ¡ç´)**ï¼š100% å·²æ•´åˆ  
- ğŸŸ¢ **ä½å„ªå…ˆç´š (å¯é¸)**ï¼šå·²è©•ä¼°ï¼Œæš«ä¸å¯¦ä½œ (generated_from, CWB rate limit)

**é€™ä»½ç¶“é Review å¼·åŒ–çš„è¨­è¨ˆå·²é”åˆ° Production-Ready çš„ä¼æ¥­ç´šæ¨™æº–ï¼** ğŸš€
